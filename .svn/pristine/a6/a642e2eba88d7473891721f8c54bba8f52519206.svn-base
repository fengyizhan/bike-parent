package com.tiamaes.bike;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.tiamaes.bike.common.bean.connector.PhotoPackage;
import com.tiamaes.bike.common.bean.message.Message;
import com.tiamaes.bike.connector.protocol.handler.Protocol0801Handler;

/**
 * 终端多媒体数据上传测试类
 * @author kangty
 *
 */
@RunWith(SpringRunner.class)
@SpringBootTest
public class Protocol0801HandlerTest extends TestConstant {
	private static Logger logger = LogManager.getLogger(Protocol0801HandlerTest.class);
	@Before
	public void before() {
	}
	
	@Test
	public void execute() throws Exception {
		byte[] body = {0, 0, 0, 8, 0, 0, 0, 1, -1, -40, -1, -32, 0, 16, 74, 70, 73, 70, 0, 1, 1, 1, 0, 72, 0, 72, 0, 0, -1, -2, 0, 19, 67, 114, 101, 97, 116, 101, 100, 32, 119, 105, 116, 104, 32, 71, 73, 77, 80, -1, -37, 0, 67, 0, 5, 3, 4, 4, 4, 3, 5, 4, 4, 4, 5, 5, 5, 6, 7, 12, 8, 7, 7, 7, 7, 15, 11, 11, 9, 12, 17, 15, 18, 18, 17, 15, 17, 17, 19, 22, 28, 23, 19, 20, 26, 21, 17, 17, 24, 33, 24, 26, 29, 29, 31, 31, 31, 19, 23, 34, 36, 34, 30, 36, 28, 30, 31, 30, -1, -37, 0, 67, 1, 5, 5, 5, 7, 6, 7, 14, 8, 8, 14, 30, 20, 17, 20, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, -1, -64, 0, 17, 8, 1, -32, 2, -128, 3, 1, 34, 0, 2, 17, 1, 3, 17, 1, -1, -60, 0, 28, 0, 1, 1, 0, 2, 3, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 4, 7, 1, 5, 6, 2, 8, -1, -60, 0, 89, 16, 0, 2, 1, 2, 4, 1, 6, 10, 6, 4, 7, 12, 9, 5, 1, 0, 0, 18, 1, 2, 3, 4, 5, 17, 97, 6, 7, 19, 33, 81, 83, -110, 21, 22, 23, 49, 65, 113, -95, -78, -47, -46, 8, 20, 34, 53, 115, 116, 50, 114, -127, -79, 35, 37, 51, 52, 66, 117, -77, 24, 36, 39, 40, 82, 84, 86, 98, -126, -111, -76, -16, 54, 99, 102, -125, -94, -92, -91, -63, -45, 38, 68, 69, -124, -29, -61, -1, -60, 0, 26, 1, 1, 0, 3, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 4, 5, 6, -1, -60, 0, 49, 17, 1, 0, 2, 2, 1, 3, 3, 2, 5, 3, 4, 3, 1, 0, 0, 0, 0, 1, 17, 2, 18, 3, 4, 33, 49, 50, 65, 81, 51, 97, 19, 34, 113, -127, -111, 52, -79, -16, 20, 35, -95, -63, 5, 98, -31, -47, -1, -38, 0, 12, 3, 1, 0, 2, 17, 3, 17, 0, 63, 0, -24, 64, 7, -104, -5, -80, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -22, -77, 124, -9, 9, -107, -30, 105, -61, -30, 45, -33, -86, -86, -88, -118, -30, 104, -90, 38, 52, -42, 99, -45, 49, -44, 118, -89, -119, -29, -102, 95, 61, -61, -45, 62, -101, 20, -57, -2, 42, -117, 97, 17, 51, -35, -121, 81, -55, -105, 30, 27, 98, -19, 60, 111, -53, 123, 12, 95, 114, -97, -104, 120, -33, -106, -10, 24, -66, -27, 63, 49, -21, 120, 103, -109, 108, -65, 49, -54, 108, -30, -85, -81, 73, -82, 53, 59, 63, 36, -7, 103, 105, -20, 38, -16, 103, 17, -44, -4, -61, 95, -8, -33, -106, -10, 24, -66, -27, 63, 48, -15, -65, 45, -20, 49, 125, -54, 126, 99, 96, 121, 39, -53, 59, 79, 96, -14, 79, -106, 118, -98, -63, 120, 21, -44, -4, -61, 95, -8, -33, -106, -10, 24, -66, -27, 63, 48, -15, -65, 45, -20, 49, 125, -54, 126, 99, 96, 121, 40, -53, 59, 79, 96, -14, 79, -106, 118, -98, -63, 120, 21, -44, -4, -61, 95, -8, -33, -106, -10, 24, -66, -27, 63, 48, -15, -65, 45, -20, 49, 125, -54, 126, 99, 96, 121, 39, -53, 59, 79, 96, -14, 79, -106, 118, -98, -63, 120, 21, -44, -4, -61, 95, -8, -33, -106, -10, 24, -66, -27, 63, 48, -15, -65, 45, -20, 49, 125, -54, 126, 99, 96, 121, 39, -53, 59, 79, 96, -14, 79, -106, 118, -98, -63, 120, 21, -44, -4, -61, 95, -8, -33, -106, -10, 24, -66, -27, 63, 48, -15, -65, 45, -20, 49, 125, -54, 126, 99, 96, 121, 39, -53, 59, 79, 96, -14, 79, -106, 118, -98, -63, 120, 21, -44, -4, -61, 95, -8, -33, -106, -10, 24, -66, -27, 63, 48, -15, -65, 45, -20, 49, 125, -54, 126, 99, 96, 121, 39, -53, 59, 79, 96, -14, 79, -106, 118, -98, -63, 120, 21, -44, -4, -61, 95, -8, -33, -106, -10, 24, -66, -27, 63, 48, -15, -65, 45, -20, 49, 125, -54, 126, 99, 96, 121, 39, -53, 59, 79, 96, -14, 79, -106, 118, -98, -63, 120, 21, -44, -4, -61, 95, -8, -33, -106, -10, 24, -66, -27, 63, 48, -15, -65, 45, -20, 49, 125, -54, 126, 99, 96, 121, 39, -53, 59, 79, 96, -14, 79, -106, 118, -98, -63, 120, 21, -44, -4, -61, 95, -8, -33, -106, -10, 24, -66, -27, 63, 48, -15, -65, 45, -20, 49, 125, -54, 126, 99, 96, 121, 39, -53, 59, 79, 96, -14, 79, -106, 118, -98, -63, 120, 21, -44, -4, -61, 95};
//		String bodyStr = "000B044D313233343541423132333435364131313232333300BEA951323334353600";
//		byte[] body = TestUtils.hexStringToByte(bodyStr);
		Message request = new Message();
		Message.Header header = request.new Header();
		header.setId(0x0801);
		header.setChildPackage(true);
		header.setEnableRSA(false);
		header.setLength(body.length);
		header.setSimNo(simNo);
		header.setSerialNo(1);
		header.setPacketNo(1);
		header.setPacketTotal(18);
		request.setBody(body);
		request.setHeader(header);
		
		PhotoPackage photoPackage = Protocol0801Handler.decodeBody(request,null);
		ObjectMapper mapper = new ObjectMapper();
		logger.info(mapper.writeValueAsString(photoPackage));
	}
	
}
